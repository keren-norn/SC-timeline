<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SC Timeline</title>
  <link rel="stylesheet" href="./assets/app.css?v=e51c253" />
  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- App principale -->
  <script src="./assets/router.js?v=e51c253" defer></script>
  <script src="./assets/app.js?v=e51c253" defer></script>

  <!-- Routeur hash (propre, sans duplication d'IDs) -->
  
</head>

<body data-mode="view"
      data-timeline-id="1771887"
      data-supabase-url="https://zruhrbabzwuwzzbfastd.supabase.co"
      data-supabase-anon-key="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpydWhyYmFiend1d3p6YmZhc3RkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg5NDYwNjYsImV4cCI6MjA4NDUyMjA2Nn0.o-j1cNpQHQtnMKEX6CXjRj3UFWeESIUAPn10B2LN2w4">

<header>
  <div class="headerWrap">
    <div>
      <h1 class="hTitle" id="pageTitle">Timeline</h1>
      <div class="hMeta" id="pageMeta"></div>
    </div>
    <div class="hRight">
      <div class="pill" id="modePill">Mode: lecture</div>
      <a class="pill" id="navEdit" href="./#edit">Ouvrir l’éditeur</a>
      <a class="pill" id="navView" href="./#timeline" style="display:none">Retour lecture</a>
    </div>
  </div>
</header>

<main>
  <!-- Sidebar wrapper : la card Filtres ET #topStatus doivent être à l'intérieur -->
  <div class="sidebar">
    <section class="card">
      <div class="hd">Filtres</div>
      <div class="bd">
        <label class="muted" for="q">Recherche</label>
        <input id="q" placeholder="titre, texte, tags…" />

        <div class="sep"></div>

        <label class="muted" for="cat">Catégorie</label>
        <select id="cat"></select>

        <div class="sep"></div>

        <div class="row">
          <div>
            <label class="muted" for="y1">Année min</label>
            <input id="y1" type="number" placeholder="-1000" />
          </div>
          <div>
            <label class="muted" for="y2">Année max</label>
            <input id="y2" type="number" placeholder="3000" />
          </div>
        </div>

        <div class="sep"></div>

        <div class="row">
          <button id="resetBtn" type="button">Réinitialiser</button>
        </div>

        <div class="sep"></div>

        <div class="row" style="margin-top:10px; display:none">
          <button id="exportSnapshotBtn" type="button">Export snapshot (GitHub)</button>
          <button id="reloadSupabaseBtn" type="button">Recharger (Supabase)</button>
        </div>

        <!-- ====== BLOC ÉDITION (visible seulement en #edit) ====== -->
        <div id="editPanel" style="display:none">
          <div class="sep"></div>

          <div class="panelTitle">Édition</div>

          <div class="row" style="margin-top:10px">
            <button id="newBtn" type="button">➕ Nouvel évènement</button>
          </div>

          <div id="uiStatus" class="muted" style="margin-top:10px;font-size:12px"></div>

          <div class="sep"></div>

          <div id="authBox" style="margin-top:14px">
            <div class="muted" style="font-size:12px;margin-bottom:8px">Connexion (Email OTP / Magic link)</div>
            <input id="authEmail" type="email" placeholder="email" />
            <div style="height:8px"></div>
            <div class="row">
              <button id="loginBtn" type="button" class="primary">Se connecter</button>
              <button id="logoutBtn" type="button" disabled>Se déconnecter</button>
            </div>
            <div id="authStatus" class="muted" style="margin-top:8px;font-size:12px">Mode: lecture</div>
            <div class="muted" id="editHint" style="margin-top:6px;font-size:12px">
              ⚠️ Pour éditer, ton email doit être dans <span class="kbd">timeline_editors</span> (Supabase).
            </div>
          </div>
        </div>
        <!-- ====== /BLOC ÉDITION ====== -->

        <div id="stats"></div>
        <div id="sbStatus" class="muted" style="margin-top:10px;font-size:12px"></div>
        <div id="status" class="muted" style="margin-top:4px;font-size:12px"></div>
        <div id="sbEditModeLine" class="muted" style="margin-top:4px;font-size:12px;display:none"></div>

        <div class="muted" style="margin-top:10px;font-size:12px">
          Astuce : <a href="./#timeline">#timeline</a> (lecture) / <a href="./#edit">#edit</a> (édition).
        </div>
      </div>
    </section>

    <!-- Barre de statut collée sous la card Filtres (doit être dans .sidebar) -->
    <div id="topStatus" aria-live="polite">
      <div class="row">
        <div class="msg" id="topStatusMsg">—</div>
        <div class="tag" id="topStatusTag">supabase</div>
      </div>
    </div>
  </div>

  <!-- Zone timeline / contenu principal -->
  <section class="timelineWrap">
    <div id="timeline"></div>
  </section>
</main>

<!-- Modale -->
<div id="backdrop" aria-hidden="true"></div>
<div id="modal" aria-hidden="true">
  <div class="mLeft">
    <div class="mTop">
      <div>
        <div class="muted" id="mdate"></div>
        <h2 class="mTitle" id="mtitle"></h2>
        <div class="mCat mcat"><span class="dot" id="mdot"></span><span id="mcat"></span></div>
        <!-- NOUVEAU : affichage du crédit/auteur (dans la modale en lecture) -->
        <div id="mcredit" class="muted" style="margin-top:6px;font-size:12px"></div>
      </div>
      <div class="mActions">
        <!-- En lecture, app.js peut les cacher -->
        <button id="editBtn" type="button" style="display:none">Modifier</button>
        <button id="saveBtn" type="button" style="display:none">Enregistrer</button>
        <button id="cancelBtn" type="button" style="display:none">Annuler</button>
        <button id="deleteBtn" type="button" style="display:none">Supprimer</button>
        <button id="closeBtn" type="button">Fermer</button>
      </div>
    </div>

    <div id="mlinks"></div>
    <div id="mtext"></div>
    <div id="mgallery"></div>

    <div id="editWrap">
      <div class="sep"></div>
      <div class="row">
        <div>
          <label class="muted" for="e_title">Titre</label>
          <input id="e_title" />
        </div>
        <div>
          <label class="muted" for="e_cat">Catégorie</label>
          <select id="e_cat"></select>
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <div>
          <label class="muted" for="e_start">Début</label>
          <input id="e_start" placeholder="YYYY-MM-DD" />
        </div>
        <div>
          <label class="muted" for="e_end">Fin</label>
          <input id="e_end" placeholder="YYYY-MM-DD" />
        </div>
      </div>
      <div style="margin-top:10px">
        <label class="muted" for="e_link">Lien externe</label>
        <input id="e_link" />
      </div>

      <!-- NOUVEAU : champ Auteur / Crédit -->
      <div style="margin-top:10px">
        <label class="muted" for="e_credit">Auteur / Crédit</label>
        <input id="e_credit" placeholder="Ex: Photo : Jean Dupont" />
      </div>

      <!-- NOUVEAU : bloc multi-images -->
      <div style="margin-top:10px">
        <label class="muted">Images</label>
        <div id="e_images"></div>
        <div style="margin-top:8px">
          <button id="e_add_image" type="button">Ajouter une image</button>
        </div>
      </div>

      <div style="margin-top:10px">
        <label class="muted" for="e_text">Texte</label>
        <textarea id="e_text"></textarea>
      </div>
    </div>
  </div>
</div>
</body>
</html>